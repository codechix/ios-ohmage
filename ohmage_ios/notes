Get Access Token
        • All server API calls for retrieving access tokens and refresh tokens, handled in the phone app asynchronously and and synchronously
Create User
        • With provider, with password, with invitation
Join ohmlet
        • POST ohmlet/<omhlet_id>/people/<person_id>
        • DELETE ohmlet/<omhlet_id>/people/<person_id>
Account Synch
        • /people/<person_id>/current — every hour
        • If updated definitions need to be retrieved
                • @GET("/surveys/{surveyId}/{surveyVersion}”)
Surveys
        • Uses synch API from above
        • Parse survey definition into internal representation
        • Survey list display - name and description
        • Taking a survey
                • prompt types
                        • single choice
                                • number
                                • string
                        • multi choice
                                • number
                                • string
                        • number
                        • text
                        • remote activity (probably not for iOS)
                        • timestamp
                        • image
                        • video
                        • audio
                • messages
                • conditions
                • skippable
Reminders
        • Uses synch API from above (3.1 or later?)
        • Time
        • Location

---------------------

https://github.com/ohmage/android/blob/master/ohmage/src/main/java/org/ohmage/sync/ResponseTypedOutput.java#L52

First, the data is added as a part and then each media file is added as a part.

This is semi-equivalent cURL command-line example.

curl --trace-ascii ./curltrace.txt -H "Content-Type: application/json" -H "Authorization: ohmage f6be6b3c-11c9-4f41-8505-3ba437db45dd" -F 'data=@data.json' -F "media=@fox.jpg;type=image/jpeg;filename=0daad9d9-3a02-4920-acfb-dcd5a230fc35" https://dev.ohmage.org/ohmage/surveys/986d601b-7dd4-4216-8797-a9e5ed8f07c1/1/data


--------------

The 3.0 server docs are here: https://github.com/ohmage/server/wiki/3.x-Documentation

We are still working on the API documentation, but we have a good version of the docs for the "people" APIs:
https://github.com/ohmage/server/wiki/3.x%20People%20APIs

For the ohmlet features, we should talk through again. Basically the standard use case for 3.0 is that a user can only belong to one ohmlet at a time.

Here is some quick documentation for uploading surveys.

For media responses, the server should return the IDs back to you and then you can read them back using the media read API call, which also needs to be documented.

The request is a POST to the following URL https://dev.ohmage.org/ohmage/<survey_id>/<survey_version>/data.

The body is similar to the ohmlet creation POST body. https://github.com/ohmage/server/wiki/3.x%20Ohmlet%20APIs#example-request-with-an-icon

The first part is the survey response JSON must be called "data". The second and any other following media part must be called "media". The Content-Disposition for each media file part must contain a filename string where the string value is the ID of a media prompt response.

The JSON data is an array of responses where each response has a metadata and a data object. (The meta_data key is incorrect and needs to be renamed to metadata. The location object is optional. Either timestamp or timestamp_millis should be present.)

{
    "meta_data": {
    "id":"A string that is a unique ID for this point.",
    "timestamp":"A W3C-formatted ISO 8601 date",
    "timestamp_millis":"Milliseconds since the UNIX epoch",
    "location" :  {
        "longitude": a valid float for longitude,
        "latitiude": a valid float for latitude,
        "accuracy": the accuracy in meters for the GPS lock,
        "time": the milliseconds since the UNIX epoch indicating when the location was obtained
    }
},
"data" : {
    "myStringMultiChoicePrompt" : [
        "foo",
        "bar"
    ],
    "myVideo" : "78ee0524-c8f6-4ce6-aba3-026e8fcc330c",
    "myImage" : "0daad9d9-3a02-4920-acfb-dcd5a230fc35",
    "myNumberSingleChoicePrompt" : 1,
    "myRemoteActivity" : {

    },
    "myAudio" : "a7b87520-a519-45ea-8d45-2debc642634d",
    "myTimestamp" : "2014-03-06",
    "myText" : "text",
    "myNumber" : 2,
    "myNumberMultiChoicePrompt" : [
        2,
        1
    ],
    "myStringSingleChoicePrompt" : "foo"
}

---------------


    "survey_items": [
        {
            "survey_item_type": "message",
            "survey_item_id": "myMessage",
            "condition": null,
            "text": "This is a sample message."
        },
        {
            "survey_item_type": "audio_prompt",
            "survey_item_id": "myAudio",
            "condition": null,
            "display_type": "recorder",
            "text": "Record an audio sample.",
            "display_label": "Audio",
            "skippable": false,
            "default_response": null,
            "max_duration": null
        },
        {
            "survey_item_type": "image_prompt",
            "survey_item_id": "myImage",
            "condition": null,
            "display_type": "camera",
            "text": "Take a picture.",
            "display_label": "Image",
            "skippable": false,
            "default_response": null,
            "max_dimension": null
        },
        {
            "survey_item_type": "video_prompt",
            "survey_item_id": "myVideo",
            "condition": null,
            "display_type": "camera",
            "text": "Take a video.",
            "display_label": "Video",
            "skippable": false,
            "default_response": null,
            "max_duration": null
        },
        {
            "survey_item_type": "number_prompt",
            "survey_item_id": "myNumber",
            "condition": null,
            "display_type": "picker",
            "text": "Choose a number.",
            "display_label": "Number",
            "skippable": false,
            "default_response": null,
            "min": null,
            "max": null,
            "whole_numbers_only": false
        },
        {
            "survey_item_type": "remote_activity_prompt",
            "survey_item_id": "myRemoteActivity",
            "condition": null,
            "display_type": "launcher",
            "text": "Launch the remote activity.",
            "display_label": "Remote Activity",
            "skippable": false,
            "default_response": null,
            "uri": "http://www.google.com/",
            "definition": {
                "type": "object",
                "optional": false,
                "fields": []
            },
            "apps": null
        },
        {
            "survey_item_type": "number_single_choice_prompt",
            "survey_item_id": "myNumberSingleChoicePrompt",
            "condition": null,
            "display_type": "list",
            "text": "Choose a number.",
            "display_label": "Number Single Choice",
            "skippable": false,
            "default_response": null,
            "choices": [
                {
                    "text": "The text to show.",
                    "value": 1
                }
            ]
        },
        {
            "survey_item_type": "string_single_choice_prompt",
            "survey_item_id": "myStringSingleChoicePrompt",
            "condition": null,
            "display_type": "list",
            "text": "Choose a string.",
            "display_label": "String Single Choice",
            "skippable": false,
            "default_response": null,
            "choices": [
                {
                    "text": "The text to show.",
                    "value": "foo"
                }
            ]
        },
        {
            "survey_item_type": "number_multi_choice_prompt",
            "survey_item_id": "myNumberMultiChoicePrompt",
            "condition": null,
            "display_type": "list",
            "text": "Choose multiple numbers.",
            "display_label": "Number Multi Choice",
            "skippable": false,
            "default_response": null,
            "choices": [
                {
                    "text": "More text to show.",
                    "value": 2
                },
                {
                    "text": "The text to show.",
                    "value": 1
                }
            ],
            "min_choices": null,
            "max_choices": null
        },
        {
            "survey_item_type": "string_multi_choice_prompt",
            "survey_item_id": "myStringMultiChoicePrompt",
            "condition": null,
            "display_type": "list",
            "text": "Choose multiple strings.",
            "display_label": "String Multi Choice",
            "skippable": false,
            "default_response": null,
            "choices": [
                {
                    "text": "More text to show.",
                    "value": "bar"
                },
                {
                    "text": "The text to show.",
                    "value": "foo"
                }
            ],
            "min_choices": null,
            "max_choices": null
        },
        {
            "survey_item_type": "text_prompt",
            "survey_item_id": "myText",
            "condition": null,
            "display_type": "textbox",
            "text": "Enter some text.",
            "display_label": "Text",
            "skippable": false,
            "default_response": null,
            "min": null,
            "max": null
        },
        {
            "survey_item_type": "timestamp_prompt",
            "survey_item_id": "myTimestamp",
            "condition": null,
            "display_type": "picker",
            "text": "Choose a date and time.",
            "display_label": "Timestamp",
            "skippable": false,
            "default_response": null
        }
    ],
    
    
    
    example data
    
    [
    {
        "owner": "8ccfa87e-cd17-4554-a36c-e3beb0e78773",
        "meta_data": {
            "id": "597ce9ba-2bc5-42fc-b8eb-fc9a9f95476d",
            "timestamp": "2014-04-04T16:21:09.091-07:00",
            "location": {
                "latitude": 37.3376102,
                "longitude": -121.9270189,
                "accuracy": 10.107999801635742,
                "time": 1396653667635
            }
        },
        "data": {
            "min": 5,
            "max": -7,
            "minDefault": 10,
            "default": 5,
            "basic": 0,
            "whole_number": 1,
            "maxDefault": 1
        }
    },
    {
        "owner": "8ccfa87e-cd17-4554-a36c-e3beb0e78773",
        "meta_data": {
            "id": "3f05cddf-cc92-4eed-b720-38c5246a5001",
            "timestamp": "2014-04-09T07:59:46.954-07:00",
            "location": {
                "latitude": 37.3370647,
                "longitude": -121.9271512,
                "accuracy": 12.618000030517578,
                "time": 1397055585787
            }
        },
        "data": {
            "min": 5,
            "minMax": 5,
            "max": 0,
            "minDefault": 10,
            "default": 5,
            "basic": 0,
            "minMaxDefault": 7,
            "whole_number": 1,
            "maxDefault": 1
        }
    }
]

// multi choice number

[
    {
        "response_metadata": {
            "id": "e4a84713-1d3a-4135-b2b9-d05f198a1663",
            "timestamp": "2014-03-30T12:05:09.246-04:00",
            "location": {
                "latitude": 40.7084679,
                "longitude": -73.9215924,
                "accuracy": 15.746999740600586,
                "time": 1396195508653
            }
        },
        "response_data": {
            "min": [
                2,
                1
            ],
            "minMax": [
                3,
                2
            ],
            "defaultSingle": [
                2
            ],
            "max": [
                3,
                2
            ],
            "minDefault": [
                2,
                1
            ],
            "basicMultiple": [
                2
            ],
            "minMaxDefault": [
                3,
                1
            ],
            "defaultMultiple": [
                2
            ],
            "basicSingle": [
                1
            ],
            "maxDefault": [
                2
            ]
        }
    }
]

Here is some quick documentation for uploading surveys.

The request is a POST to the following URL https://dev.ohmage.org/ohmage/<survey_id>/<survey_version>/data.

The body is similar to the ohmlet creation POST body. https://github.com/ohmage/server/wiki/3.x%20Ohmlet%20APIs#example-request-with-an-icon

The first part is the survey response JSON must be called "data". The second and any other following media part must be called "media". The Content-Disposition for each media file part must contain a filename string where the string value is the ID of a media prompt response.

The JSON data is an array of responses where each response has a metadata and a data object. (The meta_data key is incorrect and needs to be renamed to metadata. The location object is optional. Either timestamp or timestamp_millis should be present.)

[
{
    "meta_data": {
    "id":"uid1",
    "timestamp": null,
    "timestamp_millis":"1399320427000",
    "location" :  null
},
"data" : {
            "min": [
                2,
                1
            ],
            "minMax": [
                3,
                2
            ],
            "defaultSingle": [
                2
            ],
            "max": [
                3,
                2
            ],
            "minDefault": [
                2,
                1
            ],
            "basicMultiple": [
                2
            ],
            "minMaxDefault": [
                3,
                1
            ],
            "defaultMultiple": [
                2
            ],
            "basicSingle": [
                1
            ],
            "maxDefault": [
                2
            ]
        }
}
]